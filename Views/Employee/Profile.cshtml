@{
    ViewData["Title"] = "My Profile";
    var userId = Context.Session.GetInt32("UserId");
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />

<!-- SECTION: My Profile (Card Style) -->
<div id="profileSection" class="container mt-4">
    <h2 class="mb-4 text-center">My Profile</h2>
    <div class="row justify-content-center">
        <div class="card shadow-sm mb-4" style="max-width: 600px;">
            <div class="card-body d-flex flex-column align-items-center text-center">
                <img id="empImage" src="/image/default-avatar.PNG" alt="Profile" class="rounded-circle mb-3" style="width: 100px; height: 100px; object-fit: cover;" />
                <h4 id="empName" class="card-title">Name</h4>
                <p id="empEmail" class="text-muted">email@example.com</p>
                <ul class="list-group list-group-flush w-100 text-start">
                    <li class="list-group-item"><strong>Role:</strong> <span id="empRole"></span></li>
                    <li class="list-group-item"><strong>Position:</strong> <span id="empPosition"></span></li>
                    <li class="list-group-item"><strong>Address:</strong> <span id="empAddress"></span></li>
                    <li class="list-group-item"><strong>Salary:</strong> <span id="empSalary"></span></li>
                    <li class="list-group-item"><strong>Manager ID:</strong> <span id="empManagerId"></span></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- SECTION: My Attendance -->
<div id="attendanceSection" class="container mt-5" style="display:none;">
    <h3 class="text-center mb-4">My Attendance</h3>
    <table id="myAttendanceTable" class="table table-bordered display nowrap" style="width:100%">
        <thead class="table-dark">
            <tr>
                <th>Date</th>
                <th>Attendance Type</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>


@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <script>
        $(document).ready(function () {
            const userId = @userId;

            // Load profile
            $.ajax({
                url: '/Employee/GetEmployeeById?id=' + userId,
                method: 'GET',
                success: function (res) {
                    if (res.success) {
                        const emp = res.data;

                        $('#empImage').attr('src', emp.imagePath || '/image/default-avatar.PNG');
                        $('#empName').text(emp.name);
                        $('#empEmail').text(emp.email);
                        $('#empRole').text(emp.role);
                        $('#empPosition').text(emp.position || '—');
                        $('#empAddress').text(emp.address || '—');
                        $('#empSalary').text(emp.salary || '—');
                        $('#empManagerId').text(emp.managerId || 'N/A');
                    }
                }
            });

            // Load attendance
            $.ajax({
                url: '/Attendance/GetByEmployeeId?empId=' + userId,
                method: 'GET',
                success: function (res) {
                    if (res.success) {
                        let rows = '';
                        $.each(res.data, function (i, rec) {
                            rows += `<tr>
                                <td>${new Date(rec.date).toLocaleDateString()}</td>
                                <td>${rec.attendanceType}</td>
                            </tr>`;
                        });
                        $('#myAttendanceTable tbody').html(rows);

                        $('#myAttendanceTable').DataTable({
                            destroy: true,
                            paging: true,
                            searching: false,
                            info: false
                        });
                    }
                }
            });

            // Toggle profile and attendance sections
            $('#btnProfile').click(function () {
                $('#profileSection').show();
                $('#attendanceSection').hide();
            });

            $('#btnAttendance').click(function () {
                $('#attendanceSection').show();
                $('#profileSection').hide();
            });
        });
    </script>
}
